<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AppGeoAnaliza</title>
    <link rel="stylesheet" href="./styles/styles.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
  </head>
  <body>
    <main class="layout">
      <header class="hero">
        <div>
          <p class="eyebrow">OpenStreetMap powered</p>
          <h1>AppGeoAnaliza</h1>
          <p class="lead">
            Introduce un municipio y, opcionalmente, un barrio para obtener puntos geolocalizados desde
            OpenStreetMap.
          </p>
        </div>
      </header>

      <section class="panel step-panel">
        <div class="step-header">
          <div>
            <p class="step-badge">Paso 1</p>
            <h2>Importar expedientes</h2>
            <p class="meta">Carga un Excel o salta este paso si ya tienes los expedientes preparados.</p>
          </div>
          <div class="step-actions">
            <button id="import-excel-btn" type="button" class="btn btn-import">üìä Importar Expedientes</button>
            <button type="button" class="btn-secondary step-skip-btn">Saltar fase</button>
          </div>
        </div>
        <p class="step-feedback">Al importar los expedientes se generar√°n filas ficticias y se mostrar√°n tambi√©n en el mapa.</p>
      </section>

      <section class="panel step-panel">
        <div class="step-header">
          <div>
            <p class="step-badge">Paso 2</p>
            <h2>Crear puntos en el mapa</h2>
            <p class="meta">Elige si quieres indicar una ciudad o dibujar un √°rea, o salta esta fase y contin√∫a.</p>
          </div>
          <div class="step-actions">
            <button type="button" class="btn-secondary step-skip-btn">Saltar fase</button>
          </div>
        </div>
        <p class="step-feedback">Cuando cambies de modo aparecer√°n las cajas de b√∫squeda o el mapa para dibujar.</p>
      </section>

      <section class="panel mode-panel">
        <h2>¬øC√≥mo quieres pedir los puntos?</h2>
        <div class="mode-options">
          <label class="mode-option">
            <input type="radio" name="search-mode" value="city" checked />
            <span>
              <strong>Indicar poblaci√≥n</strong>
              <small>Usa municipio y barrio para buscar</small>
            </span>
          </label>
          <label class="mode-option">
            <input type="radio" name="search-mode" value="map" />
            <span>
              <strong>Con mapa</strong>
              <small>Dibuja un √°rea y consulta los puntos</small>
            </span>
          </label>
        </div>
      </section>

      <section class="panel step-panel">
        <div class="step-header">
          <div>
            <p class="step-badge">Paso 3</p>
            <h2>Completar datos o dibujar</h2>
            <p class="meta">Cuando elijas el modo, rellena las cajas o dibuja el pol√≠gono en el mapa, o salta esta fase.</p>
          </div>
          <div class="step-actions">
            <button type="button" class="btn-secondary step-skip-btn">Saltar fase</button>
          </div>
        </div>
        <p class="step-feedback">Define municipio y l√≠mites o traza el √°rea para ver los puntos sobre el mapa.</p>
      </section>

      <section class="panel form-panel">
        <form id="search-form" class="form">
          <div class="field">
            <label for="city">Municipio *</label>
            <input id="city" name="city" type="text" placeholder="Ej. Zaragoza" required />
          </div>
          <div class="field">
            <label for="neighbourhood">Barrio (opcional)</label>
            <input id="neighbourhood" name="neighbourhood" type="text" placeholder="Ej. Delicias" />
          </div>
          <div class="field">
            <label for="limit">N¬∫ de puntos</label>
            <input id="limit" name="limit" type="number" min="1" max="1000" value="20" />
          </div>
          <div class="form-actions">
            <button type="submit" class="btn">Buscar puntos</button>
            <button id="catastro-btn" type="button" class="btn-secondary">Buscar Catastro</button>
          </div>
        </form>
        <p class="status" id="status-message"></p>
      </section>

      <section class="panel area-panel">
        <div class="area-header">
          <div>
            <h2>Buscar por √°rea en mapa</h2>
            <p class="meta">Dibuja un pol√≠gono en el mapa haciendo clic en cada v√©rtice y ci√©rralo sobre el primer punto.</p>
          </div>
          <div class="area-actions">
            <div class="area-search" id="area-search-slot">
              <label for="area-search">Localidad en el mapa</label>
              <div class="area-search__controls">
                <input
                  id="area-search"
                  name="area-search"
                  type="text"
                  placeholder="Ej. A Coru√±a"
                  autocomplete="off"
                />
                <button id="area-search-btn" type="button" class="btn-secondary">Buscar y centrar</button>
              </div>
            </div>
            <div class="field compact-field">
              <label for="map-limit">N¬∫ de puntos</label>
              <input id="map-limit" name="map-limit" type="number" min="1" max="1000" value="20" />
            </div>
            <button id="draw-area-btn" type="button" class="btn-secondary">Dibujar √°rea</button>
            <button id="reset-area-btn" type="button" class="btn-secondary">Limpiar √°rea</button>
            <button id="search-area-btn" type="button" class="btn">Buscar en √°rea</button>
            <button id="search-area-catastro-btn" type="button" class="btn-secondary">Catastro en √°rea</button>
          </div>
        </div>
        <div id="area-map" class="area-map" aria-label="Mapa para seleccionar √°rea"></div>
        <p id="area-status" class="meta area-status"></p>
        <div id="area-coordinates" class="area-coordinates"></div>
      </section>

      <section class="panel step-panel">
        <div class="step-header">
          <div>
            <p class="step-badge">Paso 4</p>
            <h2>Importar tesauros con copia y pega</h2>
            <p class="meta">Valida los nombres y referencias pegando el listado, o salta si ya tienes la configuraci√≥n.</p>
          </div>
          <div class="step-actions">
            <button id="thesaurus-detector-btn" type="button" class="btn btn-import">üß≠ Detectar tesauros</button>
            <button type="button" class="btn-secondary step-skip-btn">Saltar fase</button>
          </div>
        </div>
        <p class="step-feedback">Puedes volver a abrir el detector en cualquier momento para revisar o completar tesauros.</p>
      </section>

      <section class="panel step-panel">
        <div class="step-header">
          <div>
            <p class="step-badge">Paso 5</p>
            <h2>Transponer datos</h2>
            <p class="meta">Transp√≥n la tabla cuando hayas importado expedientes y tesauros, o salta esta fase.</p>
          </div>
          <div class="step-actions">
            <button id="transpose-btn" type="button" class="btn btn-transpose">üîÑ Transponer datos</button>
            <button type="button" class="btn-secondary step-skip-btn">Saltar fase</button>
          </div>
        </div>
        <p class="step-feedback">Elige los campos a incluir y exporta a CSV con los mismos valores que ves en pantalla.</p>
      </section>

      <section class="panel results">
        <div class="results-header">
          <h2>Resultados</h2>
          <div class="results-actions">
            <p class="meta" id="results-meta"></p>
            <button id="import-csv-btn" type="button" class="btn btn-import">
              üìÑ Importar CSV
            </button>
            <button id="create-expedients-btn" type="button" class="btn btn-primary">
              ‚ú® Crear Expedientes
            </button>
            <button id="add-column-btn" type="button" class="btn btn-add">
              <span class="btn-icon">+</span> A√±adir columna
            </button>
            <button id="export-btn" type="button" class="btn" disabled>Exportar CSV</button>
          </div>
        </div>
        <div class="thesaurus-board">
            <div class="thesaurus-board__header">
              <div>
                <h3>Tesauros configurados</h3>
                <p class="meta">Gestiona nombres y referencias para las columnas base y personalizadas.</p>
              </div>
            </div>
          <div class="thesaurus-board__content">
            <div class="thesaurus-section">
              <h4>Columnas base</h4>
              <div id="base-thesaurus-list" class="thesaurus-chips"></div>
            </div>
            <div class="thesaurus-section">
              <div class="thesaurus-section__header">
                <h4>Columnas personalizadas</h4>
                <p id="custom-thesaurus-feedback" class="meta"></p>
              </div>
              <div id="custom-columns-list" class="thesaurus-chips"></div>
            </div>
          </div>
        </div>
        <div id="results-list" class="results-list" aria-live="polite"></div>
        <p class="attribution">Datos geogr√°ficos ¬© OpenStreetMap contributors</p>
      </section>

      <!-- Modal para seleccionar campos a transponer -->
      <div id="select-fields-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Seleccionar campos a transponer</h3>
            <button id="close-select-fields-modal" class="btn-close">&times;</button>
          </div>
          <form id="select-fields-form" class="column-form">
            <p class="help-text" style="margin-top: 0;">Selecciona los campos que deseas incluir en la transposici√≥n</p>

            <div class="field">
              <label style="font-weight: 600;">Columnas base</label>
              <div id="base-fields-checkboxes" class="checkbox-group">
                <!-- Los checkboxes de columnas base se a√±aden din√°micamente -->
              </div>
            </div>

            <div class="field">
              <label style="font-weight: 600;">Columnas personalizadas</label>
              <div id="custom-fields-checkboxes" class="checkbox-group">
                <!-- Los checkboxes de columnas personalizadas se a√±aden din√°micamente -->
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" id="cancel-select-fields" class="btn-secondary">Cancelar</button>
              <button type="submit" class="btn">Transponer</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para tabla transpuesta -->
      <div id="transpose-modal" class="modal">
        <div class="modal-content modal-large">
          <div class="modal-header">
            <h3>Datos Transpuestos (Agrupados por Expediente)</h3>
            <button id="close-transpose-modal" class="btn-close">&times;</button>
          </div>
          <div class="transpose-content">
            <div class="transpose-actions">
              <button id="export-transposed-excel" type="button" class="btn">
                üì• Exportar CSV UTF-8
              </button>
            </div>
            <div id="transposed-table-container" class="transposed-table-container">
              <!-- La tabla transpuesta se renderiza aqu√≠ -->
            </div>
          </div>
        </div>
      </div>

      <!-- Modal para exportar CSV transpuesto -->
      <div id="export-csv-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Exportar CSV de transposici√≥n</h3>
            <button id="close-export-csv-modal" class="btn-close">&times;</button>
          </div>
          <form id="export-csv-form" class="column-form">
            <div class="field">
              <label for="export-entity-name">Nombre de la entidad *</label>
              <input id="export-entity-name" type="text" placeholder="Ej: Ayuntamiento de..." required />
            </div>
            <div class="field">
              <label for="export-task-name">Nombre de la tarea *</label>
              <input id="export-task-name" type="text" placeholder="Ej: RPA data VIC" required />
            </div>
            <div class="modal-actions">
              <button type="button" id="cancel-export-csv" class="btn-secondary">Cancelar</button>
              <button type="submit" class="btn">Guardar CSV</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para importar expedientes -->
      <div id="import-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Importar Expedientes desde Excel</h3>
            <button id="close-import-modal" class="btn-close">&times;</button>
          </div>
          <form id="import-form" class="column-form">
            <p class="help-text" style="margin-top: 0;">Selecciona un archivo Excel (.xlsx, .xls) para importar los expedientes</p>

            <div class="field">
              <label for="excel-file">Archivo Excel *</label>
              <input id="excel-file" type="file" accept=".xlsx,.xls" required />
              <p class="help-text">Formatos soportados: .xlsx, .xls</p>
            </div>

            <div class="field">
              <label for="column-select">Columna a importar *</label>
              <select id="column-select" required disabled>
                <option value="">Primero carga un archivo...</option>
              </select>
              <p class="help-text">Selecciona la columna del Excel que contiene los expedientes</p>
            </div>

            <div class="field">
              <label for="expediente-name">Nombre del tesauro *</label>
              <input id="expediente-name" type="text" placeholder="Ej. Expediente" value="Expediente" required />
            </div>

            <div class="field">
              <label for="expediente-reference">Referencia *</label>
              <input id="expediente-reference" type="text" placeholder="Ej. expediente" value="expediente" required />
            </div>

            <div class="modal-actions">
              <button type="button" id="cancel-import-modal" class="btn-secondary">Cancelar</button>
              <button type="submit" class="btn">Importar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para importar CSV -->
      <div id="import-csv-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Importar columna desde CSV</h3>
            <button id="close-csv-modal" class="btn-close">&times;</button>
          </div>
          <form id="csv-form" class="column-form">
            <p class="help-text" style="margin-top: 0;">Selecciona un archivo CSV para importar una columna</p>

            <div class="field">
              <label for="csv-file">Archivo CSV *</label>
              <input id="csv-file" type="file" accept=".csv" required />
              <p class="help-text">Formato soportado: .csv (separado por comas o punto y coma)</p>
            </div>

            <div class="field">
              <label for="csv-column-select">Columna a importar *</label>
              <select id="csv-column-select" required disabled>
                <option value="">Primero carga un archivo...</option>
              </select>
              <p class="help-text">Selecciona la columna del CSV que quieres a√±adir a la tabla</p>
            </div>

            <div class="field">
              <label for="csv-column-name">Nombre del tesauro *</label>
              <input id="csv-column-name" type="text" placeholder="Ej. Nueva columna" required />
            </div>

            <div class="field">
              <label for="csv-column-reference">Referencia *</label>
              <input id="csv-column-reference" type="text" placeholder="Ej. nueva_columna" required />
            </div>

            <div class="modal-actions">
              <button type="button" id="cancel-csv-modal" class="btn-secondary">Cancelar</button>
              <button type="submit" class="btn">Importar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para detectar tesauros desde texto pegado -->
      <div id="thesaurus-detector-modal" class="modal">
        <div class="modal-content modal-large">
          <div class="modal-header">
            <h3>Detectar nombres de tesauro</h3>
            <button id="close-thesaurus-modal" class="btn-close">&times;</button>
          </div>
          <div class="column-form">
            <p class="help-text" id="thesaurus-feedback">
              Pega el texto con formato <strong>Campo: Nombre de tesauro</strong> para identificar los valores.
            </p>

            <div class="field">
              <label for="thesaurus-paste">Texto pegado</label>
              <textarea id="thesaurus-paste" class="textarea" rows="6" placeholder="Ejemplo:&#10;Longitud: Longitud (Vic)&#10;Latitud: Latitud (Vic)"></textarea>
            </div>

            <div class="modal-actions" style="justify-content: flex-end; gap: 10px;">
              <button type="button" id="thesaurus-analyze-btn" class="btn-secondary">Detectar tesauros</button>
            </div>

            <div class="thesaurus-section">
              <h4>Campos base</h4>
              <div id="thesaurus-base-results" class="thesaurus-grid"></div>
            </div>

            <div class="thesaurus-section">
              <div class="thesaurus-section-header">
                <h4>Campos adicionales</h4>
                <label class="thesaurus-check" for="thesaurus-select-all">
                  <input type="checkbox" id="thesaurus-select-all" checked />
                  <span>Seleccionar todos</span>
                </label>
              </div>
              <div id="thesaurus-extra-list" class="thesaurus-list"></div>
            </div>

            <div class="modal-actions">
              <button type="button" id="cancel-thesaurus-modal" class="btn-secondary">Cancelar</button>
              <button type="button" id="thesaurus-continue-btn" class="btn">Validar tesauros</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal para configurar tesauros base -->
      <div id="base-columns-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Configurar columnas base</h3>
            <button id="close-base-modal" class="btn-close">&times;</button>
          </div>
          <form id="base-columns-form" class="column-form">
            <p class="help-text" style="margin-top: 0;">Define los nombres de tesauro para las columnas base antes de importar los geodatos</p>

            <div class="field">
              <label for="street-name">Direcci√≥n - Nombre del tesauro *</label>
              <input id="street-name" type="text" placeholder="Ej. Direcci√≥n" required />
            </div>
            <div class="field">
              <label for="street-reference">Direcci√≥n - Referencia *</label>
              <input id="street-reference" type="text" placeholder="Ej. direccion" required />
            </div>

            <div class="field">
              <label for="lat-name">Latitud - Nombre del tesauro *</label>
              <input id="lat-name" type="text" placeholder="Ej. Latitud" required />
            </div>
            <div class="field">
              <label for="lat-reference">Latitud - Referencia *</label>
              <input id="lat-reference" type="text" placeholder="Ej. latitud" required />
            </div>

            <div class="field">
              <label for="lng-name">Longitud - Nombre del tesauro *</label>
              <input id="lng-name" type="text" placeholder="Ej. Longitud" required />
            </div>
            <div class="field">
              <label for="lng-reference">Longitud - Referencia *</label>
              <input id="lng-reference" type="text" placeholder="Ej. longitud" required />
            </div>

            <div class="modal-actions">
              <button type="button" id="cancel-base-modal" class="btn-secondary">Cancelar</button>
              <button type="submit" class="btn">Continuar b√∫squeda</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para a√±adir columna personalizada -->
      <div id="column-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>A√±adir columna personalizada</h3>
            <button id="close-modal" class="btn-close">&times;</button>
          </div>
          <form id="column-form" class="column-form">
            <div class="field">
              <label for="column-name">Nombre del tesauro *</label>
              <input id="column-name" type="text" placeholder="Ej. Precio estimado" required />
            </div>

            <div class="field">
              <label for="column-reference">Referencia *</label>
              <input id="column-reference" type="text" placeholder="Ej. precio_est" required />
              <p class="help-text">Identificador interno de la columna</p>
            </div>

            <div class="field">
              <label for="column-type">Tipo de columna *</label>
              <select id="column-type" required>
                <option value="">Seleccionar tipo...</option>
                <option value="selector">Selector (opciones con %)</option>
                <option value="number">N√∫mero</option>
                <option value="currency">Moneda</option>
                <option value="date">Fecha</option>
              </select>
            </div>

            <!-- Campo para n√∫mero de filas (solo visible si no hay datos) -->
            <div id="rows-field" class="field" style="display: none;">
              <label for="num-rows">N√∫mero de filas a generar *</label>
              <input id="num-rows" type="number" min="1" max="1000" value="20" placeholder="20" />
              <p class="help-text">Se generar√°n filas con datos ficticios para las columnas personalizadas</p>
            </div>

            <!-- Configuraci√≥n espec√≠fica para cada tipo -->
            <div id="config-selector" class="config-section" style="display: none;">
              <h4>Opciones del selector</h4>
              <div id="selector-options">
                <!-- Las opciones se a√±aden din√°micamente -->
              </div>
              <button type="button" id="add-option-btn" class="btn-secondary">+ A√±adir opci√≥n</button>
              <p class="help-text">La suma de porcentajes debe ser 100%</p>
            </div>

            <div id="config-number" class="config-section" style="display: none;">
              <div class="field-group">
                <div class="field">
                  <label for="number-min">M√≠nimo *</label>
                  <input id="number-min" type="number" step="any" placeholder="0" />
                </div>
                <div class="field">
                  <label for="number-max">M√°ximo *</label>
                  <input id="number-max" type="number" step="any" placeholder="100" />
                </div>
              </div>
              <div class="field">
                <label for="number-decimals">N¬∫ de decimales</label>
                <input id="number-decimals" type="number" min="0" max="10" step="1" value="2" />
                <p class="help-text">Define los decimales al generar, mostrar y exportar los valores num√©ricos.</p>
              </div>
              <div class="field">
                <label>Tramos porcentuales (opcional)</label>
                <div id="number-ranges" class="range-list"></div>
                <button type="button" id="add-number-range" class="btn-secondary">+ A√±adir tramo</button>
                <p class="help-text">Ejemplo: 80% entre 1 y 10, 20% entre 10 y 20. La suma debe ser 100%.</p>
              </div>
            </div>

            <div id="config-currency" class="config-section" style="display: none;">
              <div class="field-group">
                <div class="field">
                  <label for="currency-min">M√≠nimo (‚Ç¨) *</label>
                  <input id="currency-min" type="number" step="any" placeholder="0" />
                </div>
                <div class="field">
                  <label for="currency-max">M√°ximo (‚Ç¨) *</label>
                  <input id="currency-max" type="number" step="any" placeholder="10000" />
                </div>
              </div>
              <div class="field">
                <label for="currency-decimals">N¬∫ de decimales</label>
                <input id="currency-decimals" type="number" min="0" max="10" step="1" value="2" />
                <p class="help-text">Se aplica a los valores de moneda generados y exportados.</p>
              </div>
              <div class="field">
                <label>Tramos porcentuales (opcional)</label>
                <div id="currency-ranges" class="range-list"></div>
                <button type="button" id="add-currency-range" class="btn-secondary">+ A√±adir tramo</button>
                <p class="help-text">Reparte los valores por rangos, con porcentajes que sumen 100%.</p>
              </div>
            </div>

            <div id="config-date" class="config-section" style="display: none;">
              <div class="field-group">
                <div class="field">
                  <label for="date-min">Fecha m√≠nima *</label>
                  <input id="date-min" type="date" />
                </div>
                <div class="field">
                  <label for="date-max">Fecha m√°xima *</label>
                  <input id="date-max" type="date" />
                </div>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" id="cancel-modal" class="btn-secondary">Cancelar</button>
              <button type="submit" class="btn">A√±adir columna</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para crear expedientes -->
      <div id="create-expedients-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Crear Expedientes</h3>
            <button id="close-create-expedients-modal" class="btn-close">&times;</button>
          </div>
          <form id="create-expedients-form" class="column-form">
            <p class="help-text" style="margin-top: 0;">Configura los par√°metros para generar expedientes</p>

            <!-- Paso 1: Informaci√≥n b√°sica -->
            <div class="field">
              <label for="num-expedients">N√∫mero de expedientes</label>
              <input id="num-expedients" type="number" min="1" max="1000" value="10" />
              <p class="help-text">Cantidad de expedientes a generar</p>
            </div>

            <div class="field">
              <label for="entity-name">Nombre de la entidad</label>
              <input id="entity-name" type="text" placeholder="Ej. Ayuntamiento de Zaragoza" />
            </div>

            <div class="field">
              <label for="procedure-name">Nombre del procedimiento</label>
              <input id="procedure-name" type="text" placeholder="Ej. Licencia de obras" />
            </div>

            <!-- Paso 2: Asuntos libres -->
            <div class="field">
              <label style="font-weight: 600;">Asuntos libres</label>
              <p class="help-text">Define los asuntos y su porcentaje de distribuci√≥n</p>
              <div id="asunto-options">
                <div class="option-row">
                  <input type="text" class="asunto-label" placeholder="Nombre del asunto" />
                  <input type="number" class="asunto-percent" min="0" max="100" placeholder="%" />
                  <button type="button" class="btn-remove-option">√ó</button>
                </div>
              </div>
              <button type="button" id="add-asunto-btn" class="btn-secondary">+ A√±adir asunto</button>
              <p class="help-text">La suma de porcentajes debe ser 100% (si defines asuntos)</p>
            </div>

            <!-- Paso 3: Unidades gestoras -->
            <div class="field">
              <label style="font-weight: 600;">Unidades gestoras</label>
              <p class="help-text">Define las unidades gestoras y su porcentaje de distribuci√≥n</p>
              <div id="unidad-options">
                <div class="option-row">
                  <input type="text" class="unidad-label" placeholder="Nombre de la unidad" />
                  <input type="number" class="unidad-percent" min="0" max="100" placeholder="%" />
                  <button type="button" class="btn-remove-option">√ó</button>
                </div>
              </div>
              <button type="button" id="add-unidad-btn" class="btn-secondary">+ A√±adir unidad</button>
              <p class="help-text">La suma de porcentajes debe ser 100% (si defines unidades)</p>
            </div>

            <!-- Paso 4: Rango de fechas -->
            <div class="field">
              <label style="font-weight: 600;">Rango de fechas</label>
              <div class="field-group">
                <div class="field">
                  <label for="date-from">Fecha desde</label>
                  <input id="date-from" type="date" />
                </div>
                <div class="field">
                  <label for="date-to">Fecha hasta</label>
                  <input id="date-to" type="date" />
                </div>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" id="cancel-create-expedients" class="btn-secondary">Cancelar</button>
              <button type="submit" class="btn">Generar Expedientes</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal para tabla de expedientes creados -->
      <div id="expedients-table-modal" class="modal">
        <div class="modal-content modal-large">
          <div class="modal-header">
            <h3>Expedientes Creados</h3>
            <button id="close-expedients-table-modal" class="btn-close">&times;</button>
          </div>
          <div class="transpose-content">
            <div class="transpose-actions">
              <button id="export-expedients-csv" type="button" class="btn">
                üì• Exportar a CSV
              </button>
            </div>
            <div id="expedients-table-container" class="transposed-table-container">
              <!-- La tabla de expedientes se renderiza aqu√≠ -->
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Leaflet para selecci√≥n de √°reas en mapa -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <!-- SheetJS para leer archivos Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
